{{- if .Values.secret.enabled }}
{{- if .Values.secret.existingSecret }}
# Using existing secret: {{ .Values.secret.existingSecret }}
{{- else if .Values.secret.externalSecret.enabled }}
# External Secret will be managed by External Secrets Operator
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: {{ .Values.secret.externalSecret.name | default (printf "%s-external-secret" (include "dashboard.fullname" .)) }}
  namespace: {{ include "dashboard.fullname" . }}
  labels:
    {{- include "dashboard.labels" . | nindent 4 }}
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secrets-manager
    kind: ClusterSecretStore
  target:
    name: {{ include "dashboard.fullname" . }}-secret
  data:
  - secretKey: TOKEN_ENCRYPTION_KEY
    remoteRef:
      key: /nia/{{ include "dashboard.fullname" . }}/token-encryption-key
  - secretKey: POSTGRES_USER
    remoteRef:
      key: /nia/{{ include "dashboard.fullname" . }}/postgres-user
  - secretKey: POSTGRES_PORT
    remoteRef:
      key: /nia/{{ include "dashboard.fullname" . }}/postgres-port
  - secretKey: POSTGRES_PASSWORD
    remoteRef:
      key: /nia/{{ include "dashboard.fullname" . }}/postgres-password
  - secretKey: POSTGRES_HOST
    remoteRef:
      key: /nia/{{ include "dashboard.fullname" . }}/postgres-host
  - secretKey: POSTGRES_DB
    remoteRef:
      key: /nia/{{ include "dashboard.fullname" . }}/postgres-db
  - secretKey: NEXTAUTH_SECRET
    remoteRef:
      key: /nia/{{ include "dashboard.fullname" . }}/nextauth-secret
  - secretKey: NEXTAUTH_DASHBOARD_URL
    remoteRef:
      key: /nia/{{ include "dashboard.fullname" . }}/nextauth-dashboard-url
  - secretKey: NEXT_PUBLIC_AWS_S3_BUCKET_NAME
    remoteRef:
      key: /nia/{{ include "dashboard.fullname" . }}/next-public-aws-s3-bucket-name
  - secretKey: MESH_SHARED_SECRET
    remoteRef:
      key: /nia/{{ include "dashboard.fullname" . }}/mesh-shared-secret
  - secretKey: GOOGLE_DASHBOARD_CLIENT_SECRET
    remoteRef:
      key: /nia/{{ include "dashboard.fullname" . }}/google-dashboard-client-secret
  - secretKey: GOOGLE_DASHBOARD_CLIENT_ID
    remoteRef:
      key: /nia/{{ include "dashboard.fullname" . }}/google-dashboard-client-id
  - secretKey: DATABASE_URL
    remoteRef:
      key: /nia/{{ include "dashboard.fullname" . }}/database-url
{{- else if .Values.secret.data }}
# Using inline secret data (NOT recommended for production)
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "dashboard.fullname" . }}-secret
  namespace: {{ include "dashboard.fullname" . }}
  labels:
    {{- include "dashboard.labels" . | nindent 4 }}
type: Opaque
data:
  {{- toYaml .Values.secret.data | nindent 2 }}
{{- end }}
{{- end }}
