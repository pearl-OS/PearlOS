{{- if .Values.secret.enabled }}
{{- if .Values.secret.existingSecret }}
# Using existing secret: {{ .Values.secret.existingSecret }}
{{- else if .Values.secret.externalSecret.enabled }}
# External Secret will be managed by External Secrets Operator
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: {{ .Values.secret.externalSecret.name | default (printf "%s-external-secret" (include "interface.fullname" .)) }}
  namespace: {{ include "interface.fullname" . }}
  labels:
    {{- include "interface.labels" . | nindent 4 }}
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secrets-manager
    kind: ClusterSecretStore
  target:
    name: {{ include "interface.fullname" . }}-secret
  data:
  - secretKey: ANTHROPIC_API_KEY
    remoteRef:
      key: nia/{{ include "interface.fullname" . }}/anthropic-api-key
  - secretKey: GEMINI_API_KEY
    remoteRef:
      key: nia/{{ include "interface.fullname" . }}/gemini-api-key
  - secretKey: OPENAI_API_KEY
    remoteRef:
      key: nia/{{ include "interface.fullname" . }}/openai-api-key
  - secretKey: DATABASE_URL
    remoteRef:
      key: nia/{{ include "interface.fullname" . }}/database-url
  - secretKey: GOOGLE_INTERFACE_CLIENT_ID
    remoteRef:
      key: nia/{{ include "interface.fullname" . }}/google-interface-client-id
  - secretKey: GOOGLE_INTERFACE_CLIENT_SECRET
    remoteRef:
      key: nia/{{ include "interface.fullname" . }}/google-interface-client-secret
  - secretKey: MESH_SHARED_SECRET
    remoteRef:
      key: nia/{{ include "interface.fullname" . }}/mesh-shared-secret
  - secretKey: NEXT_PUBLIC_TWILIO_ACCOUNT_SID
    remoteRef:
      key: nia/{{ include "interface.fullname" . }}/next-public-twilio-account-sid
  - secretKey: NEXT_PUBLIC_TWILIO_AUTH_TOKEN
    remoteRef:
      key: nia/{{ include "interface.fullname" . }}/next-public-twilio-auth-token
  - secretKey: NEXTAUTH_INTERFACE_URL
    remoteRef:
      key: nia/{{ include "interface.fullname" . }}/nextauth-interface-url
  - secretKey: NEXTAUTH_SECRET
    remoteRef:
      key: nia/{{ include "interface.fullname" . }}/nextauth-secret
  - secretKey: POSTGRES_DB
    remoteRef:
      key: nia/{{ include "interface.fullname" . }}/postgres-db
  - secretKey: POSTGRES_HOST
    remoteRef:
      key: nia/{{ include "interface.fullname" . }}/postgres-host
  - secretKey: POSTGRES_PASSWORD
    remoteRef:
      key: nia/{{ include "interface.fullname" . }}/postgres-password
  - secretKey: POSTGRES_PORT
    remoteRef:
      key: nia/{{ include "interface.fullname" . }}/postgres-port
  - secretKey: POSTGRES_USER
    remoteRef:
      key: nia/{{ include "interface.fullname" . }}/postgres-user
  - secretKey: TOKEN_ENCRYPTION_KEY
    remoteRef:
      key: nia/{{ include "interface.fullname" . }}/token-encryption-key
  - secretKey: YOUTUBE_API_KEY
    remoteRef:
      key: nia/{{ include "interface.fullname" . }}/youtube-api-key
{{- else if .Values.secret.data }}
# Using inline secret data (NOT recommended for production)
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "interface.fullname" . }}-secret
  namespace: {{ include "interface.fullname" . }}
  labels:
    {{- include "interface.labels" . | nindent 4 }}
type: Opaque
data:
  {{- toYaml .Values.secret.data | nindent 2 }}
{{- end }}
{{- end }}
